{"version":3,"file":"react-photo-view.js","sources":["../src/hooks/useMethods.ts","../src/hooks/useSetState.ts","../src/photo-context.ts","../src/variables.ts","../src/utils/isTouchDevice.ts","../src/utils/limitTarget.ts","../src/hooks/useIsomorphicLayoutEffect.ts","../src/hooks/useEventListener.ts","../src/components/SlidePortal.tsx","../src/components/CloseIcon.tsx","../src/components/ArrowLeft.tsx","../src/components/ArrowRight.tsx","../src/components/PreventScroll.tsx","../src/utils/getMultipleTouchPosition.ts","../src/utils/edgeHandle.ts","../src/utils/getPositionOnMoveOrScale.ts","../src/utils/getRotateSize.ts","../src/utils/getSuitableImageSize.ts","../src/hooks/useDebounceCallback.ts","../src/hooks/useScrollPosition.ts","../src/hooks/useAnimationOrigin.tsx","../src/hooks/useMountedRef.ts","../src/components/Spinner.tsx","../src/Photo.tsx","../src/PhotoBox.tsx","../src/hooks/useContinuousTap.ts","../src/hooks/useAnimationPosition.ts","../src/hooks/useTargetScale.ts","../src/PhotoSlider.tsx","../src/hooks/useAnimationVisible.tsx","../src/hooks/useForkedVariable.ts","../src/hooks/useAdjacentImages.ts","../src/PhotoProvider.tsx","../src/PhotoView.tsx","../src/hooks/useInitial.ts"],"sourcesContent":["import { useRef } from 'react';\r\n\r\n/**\r\n * Hook of persistent methods\r\n */\r\nexport default function useMethods<T extends Record<string, (...args: any[]) => any>>(fn: T) {\r\n  const { current } = useRef({\r\n    fn,\r\n    curr: undefined as T | undefined,\r\n  });\r\n  current.fn = fn;\r\n\r\n  if (!current.curr) {\r\n    const curr = Object.create(null);\r\n    Object.keys(fn).forEach((key) => {\r\n      curr[key] = (...args: unknown[]) => current.fn[key].call(current.fn, ...args);\r\n    });\r\n    current.curr = curr;\r\n  }\r\n\r\n  return current.curr as T;\r\n}\r\n","import { useReducer } from 'react';\r\n\r\nexport default function useSetState<S extends Record<string, any>>(initialState: S) {\r\n  return useReducer(\r\n    (state: S, action: Partial<S> | ((state: S) => Partial<S>)) => ({\r\n      ...state,\r\n      ...(typeof action === 'function' ? action(state) : action),\r\n    }),\r\n    initialState,\r\n  );\r\n}\r\n","import { createContext } from 'react';\r\nimport type { DataType } from './types';\r\n\r\nexport type UpdateItemType = (dataType: DataType) => void;\r\n\r\nexport interface PhotoContextType {\r\n  show: (key: number) => void;\r\n  update: UpdateItemType;\r\n  remove: (key: number) => void;\r\n  nextId: () => number;\r\n}\r\n\r\nexport default createContext<PhotoContextType>(undefined as unknown as PhotoContextType);\r\n","/**\r\n * 最大触摸时间\r\n */\r\nexport const maxTouchTime = 200;\r\n\r\n/**\r\n * 默认动画速度\r\n */\r\nexport const defaultSpeed = 400;\r\n\r\n/**\r\n * 默认动画函数\r\n */\r\nexport const defaultEasing = 'cubic-bezier(0.25, 0.8, 0.25, 1)';\r\n\r\n/**\r\n * 最大滑动切换图片距离\r\n */\r\nexport const maxMoveOffset = 40;\r\n\r\n/**\r\n * 图片的间隔\r\n */\r\nexport const horizontalOffset = 20;\r\n\r\n/**\r\n * 最小初始响应距离\r\n */\r\nexport const minStartTouchOffset = 20;\r\n\r\n/**\r\n * 默认背景透明度\r\n */\r\nexport const defaultOpacity = 1;\r\n\r\n/**\r\n * 最小缩放度\r\n */\r\nexport const minScale = 1;\r\n\r\n/**\r\n * 最大缩放度（若图片足够大，则会超出）\r\n */\r\nexport const maxScale = 6;\r\n\r\n/**\r\n * 最小长图模式比例\r\n */\r\nexport const longModeRatio = 3;\r\n\r\n/**\r\n * 缩放弹性缓冲\r\n */\r\nexport const scaleBuffer = 0.2;\r\n\r\n/**\r\n * 最大等待动画时间\r\n */\r\nexport const maxWaitAnimationTime = 250;\r\n","/**\r\n * 是否支持触摸设备\r\n */\r\nconst isTouchDevice = typeof window !== 'undefined' && 'ontouchstart' in window;\r\n\r\nexport default isTouchDevice;\r\n","import { maxScale, minScale } from '../variables';\r\n\r\nexport const limitNumber = (value: number, min: number, max: number) => {\r\n  return Math.max(Math.min(value, max), min);\r\n};\r\n\r\n/**\r\n * 限制最大/最小缩放\r\n */\r\nexport const limitScale = (scale: number, max: number = 0, buffer: number = 0) => {\r\n  return limitNumber(scale, minScale * (1 - buffer), Math.max(maxScale, max) * (1 + buffer));\r\n};\r\n","import { useEffect, useLayoutEffect } from 'react';\r\n\r\nconst isSSR = typeof window === 'undefined' || /ServerSideRendering/.test(navigator && navigator.userAgent);\r\n\r\nexport default isSSR ? useEffect : useLayoutEffect;\r\n","import { useEffect, useRef } from 'react';\r\n\r\nexport default function useEventListener<K extends keyof WindowEventMap>(\r\n  type: K | undefined,\r\n  fn: (evt: WindowEventMap[K]) => void,\r\n  options?: AddEventListenerOptions,\r\n) {\r\n  const latest = useRef(fn);\r\n  latest.current = fn;\r\n\r\n  useEffect(() => {\r\n    function wrapper(evt: WindowEventMap[K]) {\r\n      latest.current(evt);\r\n    }\r\n    if (type) {\r\n      window.addEventListener(type, wrapper, options);\r\n    }\r\n    return () => {\r\n      if (type) {\r\n        window.removeEventListener(type, wrapper);\r\n      }\r\n    };\r\n  }, [type]);\r\n}\r\n","import React from 'react';\r\nimport { createPortal } from 'react-dom';\r\nimport './SlidePortal.less';\r\n\r\nexport interface ISliderPortalProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  container?: HTMLElement;\r\n}\r\n\r\nfunction SlidePortal({ container = document.body, ...rest }: ISliderPortalProps) {\r\n  return createPortal(<div {...rest} />, container);\r\n}\r\n\r\nexport default SlidePortal;\r\n","import React from 'react';\r\n\r\nfunction CloseIcon(props: React.HTMLAttributes<SVGElement>) {\r\n  return (\r\n    <svg width=\"44\" height=\"44\" viewBox=\"0 0 768 768\" {...props}>\r\n      <path d=\"M607.5 205.5l-178.5 178.5 178.5 178.5-45 45-178.5-178.5-178.5 178.5-45-45 178.5-178.5-178.5-178.5 45-45 178.5 178.5 178.5-178.5z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default CloseIcon;\r\n","import React from 'react';\r\n\r\nfunction ArrowLeft(props: React.HTMLAttributes<SVGElement>) {\r\n  return (\r\n    <svg width=\"44\" height=\"44\" viewBox=\"0 0 768 768\" {...props}>\r\n      <path d=\"M640.5 352.5v63h-390l178.5 180-45 45-256.5-256.5 256.5-256.5 45 45-178.5 180h390z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default ArrowLeft;\r\n","import React from 'react';\r\n\r\nfunction ArrowRight(props: React.HTMLAttributes<SVGElement>) {\r\n  return (\r\n    <svg width=\"44\" height=\"44\" viewBox=\"0 0 768 768\" {...props}>\r\n      <path d=\"M384 127.5l256.5 256.5-256.5 256.5-45-45 178.5-180h-390v-63h390l-178.5-180z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default ArrowRight;\r\n","import { useEffect } from 'react';\r\n\r\nexport default function PreventScroll() {\r\n  useEffect(() => {\r\n    const { style } = document.body;\r\n    const lastOverflow = style.overflow;\r\n    style.overflow = 'hidden';\r\n\r\n    return () => {\r\n      style.overflow = lastOverflow;\r\n    };\r\n  }, []);\r\n\r\n  return null;\r\n}\r\n","import type React from 'react';\r\n\r\n/**\r\n * 从 Touch 事件中获取两个触控中心位置\r\n */\r\nexport default function getMultipleTouchPosition(\r\n  evt: TouchEvent | React.TouchEvent,\r\n): [clientX: number, clientY: number, touchLength: number] {\r\n  const { clientX, clientY } = evt.touches[0];\r\n  if (evt.touches.length >= 2) {\r\n    const { clientX: nextClientX, clientY: nextClientY } = evt.touches[1];\r\n    return [\r\n      (clientX + nextClientX) / 2,\r\n      (clientY + nextClientY) / 2,\r\n      Math.sqrt((nextClientX - clientX) ** 2 + (nextClientY - clientY) ** 2),\r\n    ];\r\n  }\r\n  return [clientX, clientY, 0];\r\n}\r\n","import type { CloseEdgeType, ReachType, TouchStartType } from '../types';\r\n\r\n/**\r\n * 获取接触边缘类型\r\n */\r\nexport const getReachType = (\r\n  initialTouchState: TouchStartType,\r\n  horizontalCloseEdge: CloseEdgeType,\r\n  verticalCloseEdge: CloseEdgeType,\r\n  reachPosition: ReachType,\r\n): ReachType => {\r\n  if ((horizontalCloseEdge && initialTouchState === 1) || reachPosition === 'x') {\r\n    return 'x';\r\n  }\r\n  if ((verticalCloseEdge && initialTouchState > 1) || reachPosition === 'y') {\r\n    return 'y';\r\n  }\r\n  return undefined;\r\n};\r\n\r\n/**\r\n * 计算接触边缘位置\r\n * @param position - x/y\r\n * @param scale\r\n * @param size - width/height\r\n * @param innerSize - innerWidth/innerHeight\r\n * @return [CloseEdgeType, position]\r\n */\r\nexport const computePositionEdge = (position: number, scale: number, size: number, innerSize: number) => {\r\n  const currentWidth = size * scale;\r\n  // 图片超出的宽度\r\n  const outOffset = (currentWidth - innerSize) / 2;\r\n  let closedEdge: CloseEdgeType;\r\n\r\n  let current = position;\r\n  if (currentWidth <= innerSize) {\r\n    closedEdge = 1;\r\n    current = 0;\r\n  } else if (position > 0 && outOffset - position <= 0) {\r\n    closedEdge = 2;\r\n    current = outOffset;\r\n  } else if (position < 0 && outOffset + position <= 0) {\r\n    closedEdge = 3;\r\n    current = -outOffset;\r\n  }\r\n\r\n  return [closedEdge, current] as const;\r\n};\r\n","import { longModeRatio } from '../variables';\r\nimport { computePositionEdge } from './edgeHandle';\r\n\r\n/**\r\n * 获取移动或缩放之后的中心点\r\n */\r\nexport default function getPositionOnMoveOrScale(\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  scale: number,\r\n  toScale: number,\r\n  clientX: number = innerWidth / 2,\r\n  clientY: number = innerHeight / 2,\r\n  offsetX: number = 0,\r\n  offsetY: number = 0,\r\n) {\r\n  // 是否接触边缘\r\n  const [closedEdgeX] = computePositionEdge(x, toScale, width, innerWidth);\r\n  const [closedEdgeY] = computePositionEdge(y, toScale, height, innerHeight);\r\n\r\n  const centerClientX = innerWidth / 2;\r\n  const centerClientY = innerHeight / 2;\r\n\r\n  // 坐标偏移\r\n  const lastPositionX = centerClientX + x;\r\n  const lastPositionY = centerClientY + y;\r\n\r\n  // 偏移位置\r\n  const originX = clientX - (clientX - lastPositionX) * (toScale / scale) - centerClientX;\r\n  const originY = clientY - (clientY - lastPositionY) * (toScale / scale) - centerClientY;\r\n  // 长图模式无左右反馈\r\n  const longModeEdge = height / width >= longModeRatio && width * toScale === innerWidth;\r\n  // 超出边缘距离减半\r\n  return {\r\n    x: originX + (longModeEdge ? 0 : closedEdgeX ? offsetX / 2 : offsetX),\r\n    y: originY + (closedEdgeY ? offsetY / 2 : offsetY),\r\n    lastCX: clientX,\r\n    lastCY: clientY,\r\n  };\r\n}\r\n","/**\r\n * 获取旋转后的宽高\r\n */\r\nexport default function getRotateSize(rotate: number, width: number, height: number) {\r\n  const isVertical = rotate % 180 !== 0;\r\n\r\n  // 若图片不是水平则调换属性\r\n  if (isVertical) {\r\n    return [height, width, isVertical] as const;\r\n  }\r\n\r\n  return [width, height, isVertical] as const;\r\n}\r\n","import { longModeRatio } from '../variables';\r\nimport getRotateSize from './getRotateSize';\r\n\r\n/**\r\n * 获取图片合适的大小\r\n */\r\nexport default function getSuitableImageSize(naturalWidth: number, naturalHeight: number, rotate: number) {\r\n  const [currentWidth, currentHeight, isVertical] = getRotateSize(rotate, innerWidth, innerHeight);\r\n\r\n  let y = 0;\r\n  let width = currentWidth;\r\n  let height = currentHeight;\r\n\r\n  // 自适应宽高\r\n  const autoWidth = (naturalWidth / naturalHeight) * currentHeight;\r\n  const autoHeight = (naturalHeight / naturalWidth) * currentWidth;\r\n\r\n  if (naturalWidth < currentWidth && naturalHeight < currentHeight) {\r\n    width = naturalWidth;\r\n    height = naturalHeight;\r\n  } else if (naturalWidth < currentWidth && naturalHeight >= currentHeight) {\r\n    width = autoWidth;\r\n  } else if (naturalWidth >= currentWidth && naturalHeight < currentHeight) {\r\n    height = autoHeight;\r\n  } else if (naturalWidth / naturalHeight > currentWidth / currentHeight) {\r\n    height = autoHeight;\r\n  }\r\n  // 长图模式\r\n  else if (naturalHeight / naturalWidth >= longModeRatio && !isVertical) {\r\n    height = autoHeight;\r\n    y = (height - currentHeight) / 2;\r\n  } else {\r\n    width = autoWidth;\r\n  }\r\n  return {\r\n    width,\r\n    height,\r\n    x: 0,\r\n    y,\r\n    pause: true,\r\n  };\r\n}\r\n","import { useCallback, useRef } from 'react';\r\n\r\ninterface DebounceCallback<CallbackArguments extends any[]> {\r\n  (...args: CallbackArguments): void;\r\n  cancel: () => void;\r\n}\r\n\r\nexport default function useDebounceCallback<CallbackArguments extends any[]>(\r\n  callback: (...args: CallbackArguments) => void,\r\n  {\r\n    leading = false,\r\n    maxWait,\r\n    wait = maxWait || 0,\r\n  }: {\r\n    leading?: boolean;\r\n    maxWait?: number;\r\n    wait?: number;\r\n  },\r\n): DebounceCallback<CallbackArguments> {\r\n  const callbackRef = useRef(callback);\r\n  callbackRef.current = callback;\r\n\r\n  const prev = useRef(0);\r\n  const trailingTimeout = useRef<ReturnType<typeof setTimeout>>();\r\n  const clearTrailing = () => trailingTimeout.current && clearTimeout(trailingTimeout.current);\r\n\r\n  const fn = useCallback(\r\n    (...args: CallbackArguments) => {\r\n      const now = Date.now();\r\n\r\n      function call() {\r\n        prev.current = now;\r\n        clearTrailing();\r\n        callbackRef.current.apply(null, args);\r\n      }\r\n      const last = prev.current;\r\n      const offset = now - last;\r\n      // leading\r\n      if (last === 0) {\r\n        if (leading) {\r\n          call();\r\n        }\r\n        prev.current = now;\r\n      }\r\n\r\n      // body\r\n      if (maxWait !== undefined) {\r\n        if (offset > maxWait) {\r\n          call();\r\n          return;\r\n        }\r\n      } else if (offset < wait) {\r\n        prev.current = now;\r\n      }\r\n\r\n      // trailing\r\n      clearTrailing();\r\n      trailingTimeout.current = setTimeout(() => {\r\n        call();\r\n        prev.current = 0;\r\n      }, wait);\r\n    },\r\n    [wait, maxWait, leading],\r\n  );\r\n  (fn as DebounceCallback<CallbackArguments>).cancel = clearTrailing;\r\n\r\n  return fn as DebounceCallback<CallbackArguments>;\r\n}\r\n","import { computePositionEdge } from '../utils/edgeHandle';\r\nimport getPositionOnMoveOrScale from '../utils/getPositionOnMoveOrScale';\r\nimport getRotateSize from '../utils/getRotateSize';\r\nimport { defaultSpeed, maxTouchTime } from '../variables';\r\nimport useMethods from './useMethods';\r\n\r\n// 触边运动反馈\r\nconst rebound = (start: number, bound: number, callback: (spatial: number) => boolean) =>\r\n  easeOutMove(\r\n    start,\r\n    bound,\r\n    callback,\r\n    defaultSpeed / 4,\r\n    (t) => t,\r\n    () => easeOutMove(bound, start, callback),\r\n  );\r\n\r\n/**\r\n * 物理滚动到具体位置\r\n */\r\nexport default function useScrollPosition<C extends (spatial: number) => boolean>(\r\n  callbackX: C,\r\n  callbackY: C,\r\n  callbackS: C,\r\n) {\r\n  const callback = useMethods({\r\n    X: (spatial: number) => callbackX(spatial),\r\n    Y: (spatial: number) => callbackY(spatial),\r\n    S: (spatial: number) => callbackS(spatial),\r\n  });\r\n\r\n  return (\r\n    x: number,\r\n    y: number,\r\n    lastX: number,\r\n    lastY: number,\r\n    width: number,\r\n    height: number,\r\n    scale: number,\r\n    safeScale: number,\r\n    lastScale: number,\r\n    rotate: number,\r\n    touchedTime: number,\r\n  ) => {\r\n    const [currentWidth, currentHeight] = getRotateSize(rotate, width, height);\r\n    // 开始状态下边缘触发状态\r\n    const [beginEdgeX, beginX] = computePositionEdge(x, safeScale, currentWidth, innerWidth);\r\n    const [beginEdgeY, beginY] = computePositionEdge(y, safeScale, currentHeight, innerHeight);\r\n    const moveTime = Date.now() - touchedTime;\r\n\r\n    // 时间过长、超出安全范围的情况下不执行滚动逻辑，恢复安全范围\r\n    if (moveTime >= maxTouchTime || safeScale !== scale || Math.abs(lastScale - scale) > 1) {\r\n      // 计算中心缩放点\r\n      const { x: nextX, y: nextY } = getPositionOnMoveOrScale(x, y, width, height, scale, safeScale);\r\n      const targetX = beginEdgeX ? beginX : nextX !== x ? nextX : null;\r\n      const targetY = beginEdgeY ? beginY : nextY !== y ? nextY : null;\r\n\r\n      if (targetX !== null) {\r\n        easeOutMove(x, targetX, callback.X);\r\n      }\r\n      if (targetY !== null) {\r\n        easeOutMove(y, targetY, callback.Y);\r\n      }\r\n      if (safeScale !== scale) {\r\n        easeOutMove(scale, safeScale, callback.S);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // 初始速度\r\n    const speedX = (x - lastX) / moveTime;\r\n    const speedY = (y - lastY) / moveTime;\r\n    const speedT = Math.sqrt(speedX ** 2 + speedY ** 2);\r\n    // 是否接触到边缘\r\n    let edgeX = false;\r\n    let edgeY = false;\r\n\r\n    scrollMove(speedT, (spatial) => {\r\n      const nextX = x + spatial * (speedX / speedT);\r\n      const nextY = y + spatial * (speedY / speedT);\r\n\r\n      const [isEdgeX, currentX] = computePositionEdge(nextX, scale, currentWidth, innerWidth);\r\n      const [isEdgeY, currentY] = computePositionEdge(nextY, scale, currentHeight, innerHeight);\r\n\r\n      if (isEdgeX && !edgeX) {\r\n        edgeX = true;\r\n        if (beginEdgeX) {\r\n          easeOutMove(nextX, currentX, callback.X);\r\n        } else {\r\n          rebound(currentX, nextX + (nextX - currentX), callback.X);\r\n        }\r\n      }\r\n\r\n      if (isEdgeY && !edgeY) {\r\n        edgeY = true;\r\n        if (beginEdgeY) {\r\n          easeOutMove(nextY, currentY, callback.Y);\r\n        } else {\r\n          rebound(currentY, nextY + (nextY - currentY), callback.Y);\r\n        }\r\n      }\r\n      // 同时接触边缘的情况下停止滚动\r\n      if (edgeX && edgeY) {\r\n        return false;\r\n      }\r\n\r\n      const resultX = edgeX || callback.X(currentX);\r\n      const resultY = edgeY || callback.Y(currentY);\r\n      return resultX && resultY;\r\n    });\r\n  };\r\n}\r\n\r\n// 加速度\r\nconst acceleration = -0.001;\r\n// 阻力\r\nconst resistance = 0.0002;\r\n\r\n/**\r\n * 通过速度滚动到停止\r\n */\r\nfunction scrollMove(initialSpeed: number, callback: (spatial: number) => boolean) {\r\n  let v = initialSpeed;\r\n  let s = 0;\r\n  let lastTime: number | undefined;\r\n  let frameId = 0;\r\n\r\n  const calcMove = (now: number) => {\r\n    if (!lastTime) {\r\n      lastTime = now;\r\n    }\r\n    const dt = now - lastTime;\r\n    const direction = Math.sign(initialSpeed);\r\n    const a = direction * acceleration;\r\n    const f = Math.sign(-v) * v ** 2 * resistance;\r\n    const ds = v * dt + ((a + f) * dt ** 2) / 2;\r\n    v += (a + f) * dt;\r\n\r\n    s += ds;\r\n    // move to s\r\n    lastTime = now;\r\n\r\n    if (direction * v <= 0) {\r\n      caf();\r\n      return;\r\n    }\r\n\r\n    if (callback(s)) {\r\n      raf();\r\n      return;\r\n    }\r\n    caf();\r\n  };\r\n  raf();\r\n\r\n  function raf() {\r\n    frameId = requestAnimationFrame(calcMove);\r\n  }\r\n  function caf() {\r\n    cancelAnimationFrame(frameId);\r\n  }\r\n}\r\n\r\n/**\r\n * 缓动函数\r\n */\r\nconst easeOutQuart = (x: number) => 1 - (1 - x) ** 4;\r\n\r\n/**\r\n * 缓动回调\r\n */\r\nfunction easeOutMove(\r\n  start: number,\r\n  end: number,\r\n  callback: (spatial: number) => boolean,\r\n  speed = defaultSpeed,\r\n  easing = easeOutQuart,\r\n  complete?: () => void,\r\n) {\r\n  const distance = end - start;\r\n  if (distance === 0) {\r\n    return;\r\n  }\r\n\r\n  const startTime = Date.now();\r\n  let frameId = 0;\r\n\r\n  const calcMove = () => {\r\n    const time = Math.min(1, (Date.now() - startTime) / speed);\r\n    const result = callback(start + easing(time) * distance);\r\n\r\n    if (result && time < 1) {\r\n      raf();\r\n      return;\r\n    }\r\n    cancelAnimationFrame(frameId);\r\n    if (time >= 1 && complete) {\r\n      complete();\r\n    }\r\n  };\r\n  raf();\r\n\r\n  function raf() {\r\n    frameId = requestAnimationFrame(calcMove);\r\n  }\r\n}\r\n","import type { Dispatch, MutableRefObject, SetStateAction } from 'react';\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport type { EasingMode, OriginRectType } from '../types';\r\nimport useMethods from './useMethods';\r\nimport { maxWaitAnimationTime } from '../variables';\r\n\r\nconst initialRect: OriginRectType = {\r\n  T: 0,\r\n  L: 0,\r\n  W: 0,\r\n  H: 0,\r\n  // 图像填充方式\r\n  FIT: undefined,\r\n};\r\n\r\nexport default function useAnimationOrigin(\r\n  visible: boolean | undefined,\r\n  originRef: MutableRefObject<HTMLElement | null> | undefined,\r\n  loaded: boolean,\r\n  speed: number,\r\n  updateEasing: (pause: boolean) => void,\r\n): [\r\n  // 动画状态\r\n  easingMode: EasingMode,\r\n  originRect: OriginRectType,\r\n] {\r\n  const [originRect, updateOriginRect] = useState(initialRect);\r\n  // 动画状态\r\n  const [easingMode, updateEasingMode] = useState<EasingMode>(0);\r\n  const initialTime = useRef<number>();\r\n\r\n  const fn = useMethods({\r\n    OK: () => visible && updateEasingMode(4),\r\n  });\r\n\r\n  useEffect(() => {\r\n    // 记录初始打开的时间\r\n    if (!initialTime.current) {\r\n      initialTime.current = Date.now();\r\n    }\r\n    if (!loaded) {\r\n      return;\r\n    }\r\n    handleUpdateOrigin(originRef, updateOriginRect);\r\n    // 打开动画处理\r\n    if (visible) {\r\n      // 小于最大允许动画时间，则执行缩放动画\r\n      if (Date.now() - initialTime.current < maxWaitAnimationTime) {\r\n        updateEasingMode(1);\r\n        // 延时执行动画，保持 transition 生效\r\n        requestAnimationFrame(() => {\r\n          updateEasingMode(2);\r\n          requestAnimationFrame(() => handleToShape(3));\r\n        });\r\n        setTimeout(fn.OK, speed);\r\n        return;\r\n      }\r\n      // 超出则不执行\r\n      updateEasingMode(4);\r\n      return;\r\n    }\r\n    // 关闭动画处理\r\n    handleToShape(5);\r\n  }, [visible, loaded]);\r\n\r\n  function handleToShape(currentShape: EasingMode) {\r\n    updateEasing(false);\r\n    updateEasingMode(currentShape);\r\n  }\r\n\r\n  return [easingMode, originRect];\r\n}\r\n\r\n/**\r\n * 更新缩略图位置信息\r\n */\r\nfunction handleUpdateOrigin(\r\n  originRef: MutableRefObject<HTMLElement | null> | undefined,\r\n  updateOriginRect: Dispatch<SetStateAction<typeof initialRect>>,\r\n) {\r\n  const element = originRef && originRef.current;\r\n\r\n  if (element && element.nodeType === 1) {\r\n    // 获取触发时节点位置\r\n    const { top, left, width, height } = element.getBoundingClientRect();\r\n    const isImage = element.tagName === 'IMG';\r\n    updateOriginRect({\r\n      T: top,\r\n      L: left,\r\n      W: width,\r\n      H: height,\r\n      FIT: isImage ? (getComputedStyle(element).objectFit as 'contain' | 'cover' | 'fill' | undefined) : undefined,\r\n    });\r\n  }\r\n}\r\n","import { useEffect, useRef } from 'react';\r\n\r\nconst useMountedRef = () => {\r\n  const mountedRef = useRef(false);\r\n  useEffect(() => {\r\n    mountedRef.current = true;\r\n    return () => {\r\n      mountedRef.current = false;\r\n    };\r\n  }, []);\r\n  return mountedRef;\r\n};\r\n\r\nexport default useMountedRef;\r\n","import React from 'react';\r\nimport './Spinner.less';\r\n\r\n// eslint-disable-next-line react/prop-types\r\nfunction Spinner({ className = '', ...props }: React.HTMLAttributes<HTMLElement>) {\r\n  return (\r\n    <div className={`PhotoView__Spinner ${className}`} {...props}>\r\n      <svg viewBox=\"0 0 32 32\" width=\"36\" height=\"36\" fill=\"white\">\r\n        <path opacity=\".25\" d=\"M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4\" />\r\n        <path d=\"M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z\" />\r\n      </svg>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Spinner;\r\n","import React from 'react';\r\nimport Spinner from './components/Spinner';\r\nimport useMountedRef from './hooks/useMountedRef';\r\nimport type { BrokenElementParams } from './types';\r\nimport './Photo.less';\r\n\r\nexport interface IPhotoLoadedParams {\r\n  loaded?: boolean;\r\n  naturalWidth?: number;\r\n  naturalHeight?: number;\r\n  broken?: boolean;\r\n}\r\n\r\nexport interface IPhotoProps extends React.HTMLAttributes<HTMLElement> {\r\n  src: string;\r\n  loaded: boolean;\r\n  broken: boolean;\r\n  onPhotoLoad: (params: IPhotoLoadedParams) => void;\r\n  loadingElement?: JSX.Element;\r\n  brokenElement?: JSX.Element | ((photoProps: BrokenElementParams) => JSX.Element);\r\n}\r\n\r\nexport default function Photo({\r\n  src,\r\n  loaded,\r\n  broken,\r\n  className,\r\n  onPhotoLoad,\r\n  loadingElement,\r\n  brokenElement,\r\n  ...restProps\r\n}: IPhotoProps) {\r\n  const mountedRef = useMountedRef();\r\n\r\n  function handleImageLoaded(e: React.SyntheticEvent<HTMLImageElement>) {\r\n    const { naturalWidth, naturalHeight } = e.target as HTMLImageElement;\r\n    if (mountedRef.current) {\r\n      onPhotoLoad({\r\n        loaded: true,\r\n        naturalWidth,\r\n        naturalHeight,\r\n      });\r\n    }\r\n  }\r\n\r\n  function handleImageBroken() {\r\n    if (mountedRef.current) {\r\n      onPhotoLoad({\r\n        broken: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  if (src && !broken) {\r\n    return (\r\n      <>\r\n        <img\r\n          className={`PhotoView__Photo${className ? ` ${className}` : ''}`}\r\n          src={src}\r\n          onLoad={handleImageLoaded}\r\n          onError={handleImageBroken}\r\n          draggable={false}\r\n          alt=\"\"\r\n          {...restProps}\r\n        />\r\n        {!loaded &&\r\n          (loadingElement ? (\r\n            <span className=\"PhotoView__icon\">{loadingElement}</span>\r\n          ) : (\r\n            <Spinner className=\"PhotoView__icon\" />\r\n          ))}\r\n      </>\r\n    );\r\n  }\r\n\r\n  if (brokenElement) {\r\n    return (\r\n      <span className=\"PhotoView__icon\">\r\n        {typeof brokenElement === 'function' ? brokenElement({ src }) : brokenElement}\r\n      </span>\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n","import React, { useRef } from 'react';\r\nimport isTouchDevice from './utils/isTouchDevice';\r\nimport getMultipleTouchPosition from './utils/getMultipleTouchPosition';\r\nimport getPositionOnMoveOrScale from './utils/getPositionOnMoveOrScale';\r\nimport { getReachType, computePositionEdge } from './utils/edgeHandle';\r\nimport getRotateSize from './utils/getRotateSize';\r\nimport { limitScale } from './utils/limitTarget';\r\nimport getSuitableImageSize from './utils/getSuitableImageSize';\r\nimport useIsomorphicLayoutEffect from './hooks/useIsomorphicLayoutEffect';\r\nimport { minStartTouchOffset, scaleBuffer } from './variables';\r\nimport type {\r\n  DataType,\r\n  ReachMoveFunction,\r\n  ReachFunction,\r\n  PhotoTapFunction,\r\n  BrokenElementParams,\r\n  ExposedProperties,\r\n  ReachType,\r\n  TouchStartType,\r\n} from './types';\r\nimport useSetState from './hooks/useSetState';\r\nimport useMethods from './hooks/useMethods';\r\nimport useDebounceCallback from './hooks/useDebounceCallback';\r\nimport useEventListener from './hooks/useEventListener';\r\nimport useContinuousTap from './hooks/useContinuousTap';\r\nimport useScrollPosition from './hooks/useScrollPosition';\r\nimport useAnimationPosition from './hooks/useAnimationPosition';\r\nimport useMountedRef from './hooks/useMountedRef';\r\nimport type { IPhotoLoadedParams } from './Photo';\r\nimport Photo from './Photo';\r\nimport './PhotoBox.less';\r\n\r\nexport interface PhotoBoxProps {\r\n  // 图片信息\r\n  item: DataType;\r\n  // 是否可见\r\n  visible: boolean;\r\n  // 动画时间\r\n  speed: number;\r\n  // 动画函数\r\n  easing: string;\r\n  // 容器类名\r\n  wrapClassName?: string;\r\n  // 图片类名\r\n  className?: string;\r\n  // style\r\n  style?: object;\r\n  // 自定义 loading\r\n  loadingElement?: JSX.Element;\r\n  // 加载失败 Element\r\n  brokenElement?: JSX.Element | ((photoProps: BrokenElementParams) => JSX.Element);\r\n\r\n  // Photo 点击事件\r\n  onPhotoTap: PhotoTapFunction;\r\n  // Mask 点击事件\r\n  onMaskTap: PhotoTapFunction;\r\n  // 到达边缘滑动事件\r\n  onReachMove: ReachMoveFunction;\r\n  // 触摸解除事件\r\n  onReachUp: ReachFunction;\r\n  // Resize 事件\r\n  onPhotoResize: () => void;\r\n  // 向父组件导出属性\r\n  expose: (state: ExposedProperties) => void;\r\n  // 是否在当前操作中\r\n  isActive: boolean;\r\n}\r\n\r\nconst initialState = {\r\n  // 真实宽度\r\n  naturalWidth: undefined as number | undefined,\r\n  // 真实高度\r\n  naturalHeight: undefined as number | undefined,\r\n  // 宽度\r\n  width: undefined as number | undefined,\r\n  // 高度\r\n  height: undefined as number | undefined,\r\n  // 加载成功状态\r\n  loaded: undefined as boolean | undefined,\r\n  // 破碎状态\r\n  broken: false,\r\n\r\n  // 图片 X 偏移量\r\n  x: 0,\r\n  // 图片 y 偏移量\r\n  y: 0,\r\n  // 图片处于触摸的状态\r\n  touched: false,\r\n  // 背景处于触摸状态\r\n  maskTouched: false,\r\n  // 旋转状态\r\n  rotate: 0,\r\n  // 放大缩小\r\n  scale: 1,\r\n\r\n  // 触摸开始时 x 原始坐标\r\n  CX: 0,\r\n  // 触摸开始时 y 原始坐标\r\n  CY: 0,\r\n\r\n  // 触摸开始时图片 x 偏移量\r\n  lastX: 0,\r\n  // 触摸开始时图片 y 偏移量\r\n  lastY: 0,\r\n  // 上一个触摸状态 x 原始坐标\r\n  lastCX: 0,\r\n  // 上一个触摸状态 y 原始坐标\r\n  lastCY: 0,\r\n  // 上一个触摸状态的 scale\r\n  lastScale: 1,\r\n\r\n  // 触摸开始时时间\r\n  touchTime: 0,\r\n  // 多指触控间距\r\n  touchLength: 0,\r\n  // 是否暂停 transition\r\n  pause: true,\r\n  // 停止 Raf\r\n  stopRaf: true,\r\n  // 当前边缘触发状态\r\n  reach: undefined as ReachType,\r\n};\r\n\r\nexport default function PhotoBox({\r\n  item: { src, render, width: customWidth = 0, height: customHeight = 0, originRef },\r\n  visible,\r\n  speed,\r\n  easing,\r\n  wrapClassName,\r\n  className,\r\n  style,\r\n  loadingElement,\r\n  brokenElement,\r\n\r\n  onPhotoTap,\r\n  onMaskTap,\r\n  onReachMove,\r\n  onReachUp,\r\n  onPhotoResize,\r\n  isActive,\r\n  expose,\r\n}: PhotoBoxProps) {\r\n  const [state, updateState] = useSetState(initialState);\r\n  const initialTouchRef = useRef<TouchStartType>(0);\r\n  const mounted = useMountedRef();\r\n\r\n  const {\r\n    naturalWidth = customWidth,\r\n    naturalHeight = customHeight,\r\n    width = customWidth,\r\n    height = customHeight,\r\n    loaded = !src,\r\n    broken,\r\n    x,\r\n    y,\r\n    touched,\r\n    stopRaf,\r\n    maskTouched,\r\n    rotate,\r\n    scale,\r\n    CX,\r\n    CY,\r\n    lastX,\r\n    lastY,\r\n    lastCX,\r\n    lastCY,\r\n    lastScale,\r\n    touchTime,\r\n    touchLength,\r\n    pause,\r\n    reach,\r\n  } = state;\r\n\r\n  const fn = useMethods({\r\n    onScale: (current: number) => onScale(limitScale(current)),\r\n    onRotate(current: number) {\r\n      if (rotate !== current) {\r\n        expose({ rotate: current });\r\n        updateState({ rotate: current, ...getSuitableImageSize(naturalWidth, naturalHeight, current) });\r\n      }\r\n    },\r\n  });\r\n\r\n  // 默认为屏幕中心缩放\r\n  function onScale(current: number, clientX?: number, clientY?: number) {\r\n    if (scale !== current) {\r\n      expose({ scale: current });\r\n      updateState({\r\n        scale: current,\r\n        ...getPositionOnMoveOrScale(x, y, width, height, scale, current, clientX, clientY),\r\n        ...(current <= 1 && { x: 0, y: 0 }),\r\n      });\r\n    }\r\n  }\r\n\r\n  const handleMove = useDebounceCallback(\r\n    (nextClientX: number, nextClientY: number, currentTouchLength: number = 0) => {\r\n      if ((touched || maskTouched) && isActive) {\r\n        // 通过旋转调换宽高\r\n        const [currentWidth, currentHeight] = getRotateSize(rotate, width, height);\r\n        // 单指最小缩放下，以初始移动距离来判断意图\r\n        if (currentTouchLength === 0 && initialTouchRef.current === 0) {\r\n          const isStillX = Math.abs(nextClientX - CX) <= minStartTouchOffset;\r\n          const isStillY = Math.abs(nextClientY - CY) <= minStartTouchOffset;\r\n          // 初始移动距离不足\r\n          if (isStillX && isStillY) {\r\n            // 方向记录上次移动距离，以便平滑过渡\r\n            updateState({ lastCX: nextClientX, lastCY: nextClientY });\r\n            return;\r\n          }\r\n          // 设置响应状态\r\n          initialTouchRef.current = !isStillX ? 1 : nextClientY > CY ? 3 : 2;\r\n        }\r\n\r\n        const offsetX = nextClientX - lastCX;\r\n        const offsetY = nextClientY - lastCY;\r\n        // 边缘触发状态\r\n        let currentReach: ReachType;\r\n        if (currentTouchLength === 0) {\r\n          // 边缘超出状态\r\n          const [horizontalCloseEdge] = computePositionEdge(offsetX + lastX, scale, currentWidth, innerWidth);\r\n          const [verticalCloseEdge] = computePositionEdge(offsetY + lastY, scale, currentHeight, innerHeight);\r\n          // 边缘触发检测\r\n          currentReach = getReachType(initialTouchRef.current, horizontalCloseEdge, verticalCloseEdge, reach);\r\n\r\n          // 接触边缘\r\n          if (currentReach !== undefined) {\r\n            onReachMove(currentReach, nextClientX, nextClientY, scale);\r\n          }\r\n        }\r\n        // 横向边缘触发、背景触发禁用当前滑动\r\n        if (currentReach === 'x' || maskTouched) {\r\n          updateState({ reach: 'x' });\r\n          return;\r\n        }\r\n        // 目标倍数\r\n        const toScale = limitScale(\r\n          scale + ((currentTouchLength - touchLength) / 100 / 2) * scale,\r\n          naturalWidth / width,\r\n          scaleBuffer,\r\n        );\r\n        // 导出变量\r\n        expose({ scale: toScale });\r\n        updateState({\r\n          touchLength: currentTouchLength,\r\n          reach: currentReach,\r\n          scale: toScale,\r\n          ...getPositionOnMoveOrScale(x, y, width, height, scale, toScale, nextClientX, nextClientY, offsetX, offsetY),\r\n        });\r\n      }\r\n    },\r\n    {\r\n      maxWait: 8,\r\n    },\r\n  );\r\n\r\n  function updateRaf(position: { x?: number; y?: number }) {\r\n    if (stopRaf || touched) {\r\n      return false;\r\n    }\r\n    if (mounted.current) {\r\n      // 下拉关闭时可以有动画\r\n      updateState({ ...position, pause: visible });\r\n    }\r\n    return mounted.current;\r\n  }\r\n\r\n  const slideToPosition = useScrollPosition(\r\n    (nextX) => updateRaf({ x: nextX }),\r\n    (nextY) => updateRaf({ y: nextY }),\r\n    (nextScale) => {\r\n      if (mounted.current) {\r\n        expose({ scale: nextScale });\r\n        updateState({ scale: nextScale });\r\n      }\r\n      return !touched && mounted.current;\r\n    },\r\n  );\r\n\r\n  const handlePhotoTap = useContinuousTap(onPhotoTap, (currentClientX: number, currentClientY: number) => {\r\n    if (!reach) {\r\n      // 若图片足够大，则放大适应的倍数\r\n      const endScale = scale !== 1 ? 1 : Math.max(2, naturalWidth / width);\r\n      onScale(endScale, currentClientX, currentClientY);\r\n    }\r\n  });\r\n\r\n  function handleUp(nextClientX: number, nextClientY: number) {\r\n    // 重置响应状态\r\n    initialTouchRef.current = 0;\r\n    if ((touched || maskTouched) && isActive) {\r\n      updateState({\r\n        touched: false,\r\n        maskTouched: false,\r\n        pause: false,\r\n        stopRaf: false,\r\n        reach: undefined,\r\n      });\r\n      const safeScale = limitScale(scale, naturalWidth / width);\r\n      // Go\r\n      slideToPosition(x, y, lastX, lastY, width, height, scale, safeScale, lastScale, rotate, touchTime);\r\n\r\n      onReachUp(nextClientX, nextClientY);\r\n      // 触发 Tap 事件\r\n      if (CX === nextClientX && CY === nextClientY) {\r\n        if (touched) {\r\n          handlePhotoTap(nextClientX, nextClientY);\r\n          return;\r\n        }\r\n        if (maskTouched) {\r\n          onMaskTap(nextClientX, nextClientY);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  useEventListener(isTouchDevice ? undefined : 'mousemove', (e) => {\r\n    e.preventDefault();\r\n    handleMove(e.clientX, e.clientY);\r\n  });\r\n  useEventListener(isTouchDevice ? undefined : 'mouseup', (e) => {\r\n    handleUp(e.clientX, e.clientY);\r\n  });\r\n  useEventListener(\r\n    isTouchDevice ? 'touchmove' : undefined,\r\n    (e) => {\r\n      e.preventDefault();\r\n      const position = getMultipleTouchPosition(e);\r\n      handleMove(...position);\r\n    },\r\n    { passive: false },\r\n  );\r\n  useEventListener(\r\n    isTouchDevice ? 'touchend' : undefined,\r\n    ({ changedTouches }) => {\r\n      const touch = changedTouches[0];\r\n      handleUp(touch.clientX, touch.clientY);\r\n    },\r\n    { passive: false },\r\n  );\r\n  useEventListener(\r\n    'resize',\r\n    useDebounceCallback(\r\n      () => {\r\n        if (loaded && !touched) {\r\n          updateState(getSuitableImageSize(naturalWidth, naturalHeight, rotate));\r\n          onPhotoResize();\r\n        }\r\n      },\r\n      { maxWait: 8 },\r\n    ),\r\n  );\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    if (isActive) {\r\n      expose({ scale, rotate, ...fn });\r\n    }\r\n  }, [isActive]);\r\n\r\n  function handlePhotoLoad(params: IPhotoLoadedParams) {\r\n    updateState({\r\n      ...params,\r\n      ...(params.loaded && getSuitableImageSize(params.naturalWidth || 0, params.naturalHeight || 0, rotate)),\r\n    });\r\n  }\r\n\r\n  function handleStart(currentClientX: number, currentClientY: number, currentTouchLength: number = 0) {\r\n    updateState({\r\n      touched: true,\r\n      CX: currentClientX,\r\n      CY: currentClientY,\r\n      lastCX: currentClientX,\r\n      lastCY: currentClientY,\r\n      lastX: x,\r\n      lastY: y,\r\n      lastScale: scale,\r\n      touchLength: currentTouchLength,\r\n      touchTime: Date.now(),\r\n    });\r\n  }\r\n\r\n  function handleWheel(e: React.WheelEvent) {\r\n    if (!reach) {\r\n      // 限制最大倍数和最小倍数\r\n      const toScale = limitScale(scale - e.deltaY / 100 / 2, naturalWidth / width);\r\n      updateState({ stopRaf: true });\r\n      onScale(toScale, e.clientX, e.clientY);\r\n    }\r\n  }\r\n\r\n  function handleMaskStart(e: { clientX: number; clientY: number }) {\r\n    updateState({\r\n      maskTouched: true,\r\n      CX: e.clientX,\r\n      CY: e.clientY,\r\n      lastX: x,\r\n      lastY: y,\r\n    });\r\n  }\r\n\r\n  function handleTouchStart(e: React.TouchEvent) {\r\n    e.stopPropagation();\r\n    handleStart(...getMultipleTouchPosition(e));\r\n  }\r\n\r\n  function handleMouseDown(e: React.MouseEvent) {\r\n    e.stopPropagation();\r\n    if (e.button === 0) {\r\n      handleStart(e.clientX, e.clientY, 0);\r\n    }\r\n  }\r\n\r\n  // 计算位置\r\n  const [translateX, translateY, currentWidth, currentHeight, currentScale, opacity, easingMode, FIT] =\r\n    useAnimationPosition(visible, originRef, loaded, x, y, width, height, scale, speed, (isPause: boolean) =>\r\n      updateState({ pause: isPause }),\r\n    );\r\n  // 图片 objectFit 渐变时间\r\n  const transitionLayoutTime = easingMode < 4 ? speed / 2 : easingMode > 4 ? speed : 0;\r\n  const transitionCSS = `transform ${speed}ms ${easing}`;\r\n\r\n  const attrs = {\r\n    className,\r\n    onMouseDown: isTouchDevice ? undefined : handleMouseDown,\r\n    onTouchStart: isTouchDevice ? handleTouchStart : undefined,\r\n    onWheel: handleWheel,\r\n    style: {\r\n      width: `${currentWidth}px`,\r\n      height: `${currentHeight}px`,\r\n      opacity,\r\n      objectFit: easingMode === 4 ? undefined : FIT,\r\n      transform: rotate ? `rotate(${rotate}deg)` : undefined,\r\n      transition:\r\n        // 初始状态无渐变\r\n        easingMode > 2\r\n          ? `${transitionCSS}, opacity ${speed}ms ease, height ${transitionLayoutTime}ms ${easing}`\r\n          : undefined,\r\n    },\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={`PhotoView__PhotoWrap${wrapClassName ? ` ${wrapClassName}` : ''}`}\r\n      style={style}\r\n      onMouseDown={!isTouchDevice && isActive ? handleMaskStart : undefined}\r\n      onTouchStart={isTouchDevice && isActive ? (e) => handleMaskStart(e.touches[0]) : undefined}\r\n    >\r\n      <div\r\n        className=\"PhotoView__PhotoBox\"\r\n        style={{\r\n          transform: `matrix(${currentScale}, 0, 0, ${currentScale}, ${translateX}, ${translateY})`,\r\n          transition: touched || pause ? undefined : transitionCSS,\r\n          willChange: isActive ? 'transform' : undefined,\r\n        }}\r\n      >\r\n        {src ? (\r\n          <Photo\r\n            src={src}\r\n            loaded={loaded}\r\n            broken={broken}\r\n            {...attrs}\r\n            onPhotoLoad={handlePhotoLoad}\r\n            loadingElement={loadingElement}\r\n            brokenElement={brokenElement}\r\n          />\r\n        ) : (\r\n          render && render({ attrs, scale: currentScale, rotate })\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { useRef } from 'react';\r\nimport useDebounceCallback from './useDebounceCallback';\r\n\r\nexport type TapFuncType<T> = (...args: T[]) => void;\r\n\r\n/**\r\n * 单击和双击事件处理\r\n * @param singleTap - 单击事件\r\n * @param doubleTap - 双击事件\r\n * @return invokeTap\r\n */\r\nexport default function useContinuousTap<T>(singleTap: TapFuncType<T>, doubleTap: TapFuncType<T>): TapFuncType<T> {\r\n  // 当前连续点击次数\r\n  const continuousClick = useRef(0);\r\n\r\n  const debounceTap = useDebounceCallback(\r\n    (...args) => {\r\n      continuousClick.current = 0;\r\n      singleTap(...args);\r\n    },\r\n    {\r\n      wait: 300,\r\n    },\r\n  );\r\n\r\n  return function invokeTap(...args) {\r\n    continuousClick.current += 1;\r\n    debounceTap(...args);\r\n    // 双击\r\n    if (continuousClick.current >= 2) {\r\n      debounceTap.cancel();\r\n      continuousClick.current = 0;\r\n      doubleTap(...args);\r\n    }\r\n  };\r\n}\r\n","import type { MutableRefObject } from 'react';\r\nimport useAnimationOrigin from './useAnimationOrigin';\r\nimport useTargetScale from './useTargetScale';\r\n\r\nexport default function useAnimationPosition(\r\n  visible: boolean | undefined,\r\n  originRef: MutableRefObject<HTMLElement | null> | undefined,\r\n  loaded: boolean,\r\n  x: number,\r\n  y: number,\r\n  width: number,\r\n  height: number,\r\n  scale: number,\r\n  speed: number,\r\n  updateEasing: (pause: boolean) => void,\r\n) {\r\n  // 延迟更新 width/height\r\n  const [autoWidth, autoHeight, autoScale] = useTargetScale(width, height, scale, speed, updateEasing);\r\n  // 动画源处理\r\n  const [easingMode, originRect] = useAnimationOrigin(visible, originRef, loaded, speed, updateEasing);\r\n\r\n  // 计算动画位置\r\n  const { T, L, W, H, FIT } = originRect;\r\n  // 偏移量，x: 0, y: 0 居中为初始\r\n  const centerWidth = innerWidth / 2;\r\n  const centerHeight = innerHeight / 2;\r\n  const offsetX = centerWidth - (width * scale) / 2;\r\n  const offsetY = centerHeight - (height * scale) / 2;\r\n  // 缩略图状态\r\n  const miniMode = easingMode < 3 || easingMode > 4;\r\n  // 有缩略图时，则为缩略图的位置，否则居中\r\n  const translateX = miniMode ? (W ? L : centerWidth) : x + offsetX;\r\n  const translateY = miniMode ? (W ? T : centerHeight) : y + offsetY;\r\n\r\n  // 最小值缩放\r\n  const minScale = W / (width * scale) || 0.01;\r\n\r\n  // 适应 objectFit 保持缩略图宽高比\r\n  const currentHeight = miniMode && FIT ? autoWidth * (H / W) : autoHeight;\r\n  // 初始加载情况无缩放\r\n  const currentScale = easingMode === 0 ? autoScale : miniMode ? minScale : autoScale;\r\n  const opacity = miniMode ? (FIT ? 1 : 0) : 1;\r\n\r\n  return [translateX, translateY, autoWidth, currentHeight, currentScale, opacity, easingMode, FIT] as const;\r\n}\r\n","import { useRef } from 'react';\r\nimport useSetState from './useSetState';\r\nimport useIsomorphicLayoutEffect from './useIsomorphicLayoutEffect';\r\nimport useDebounceCallback from './useDebounceCallback';\r\n\r\n/**\r\n * 目标缩放延迟处理\r\n */\r\nexport default function useTargetScale(\r\n  realWidth: number,\r\n  realHeight: number,\r\n  realScale: number,\r\n  speed: number,\r\n  updateEasing: (pause: boolean) => void,\r\n) {\r\n  const execRef = useRef(false);\r\n\r\n  const [{ lead, scale }, updateState] = useSetState({ lead: true, scale: realScale });\r\n\r\n  const moveScale = useDebounceCallback(\r\n    async (current: number) => {\r\n      updateEasing(true);\r\n      updateState({ lead: false, scale: current });\r\n    },\r\n    { wait: speed },\r\n  );\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    if (!execRef.current) {\r\n      execRef.current = true;\r\n      return;\r\n    }\r\n    updateEasing(false);\r\n    updateState({ lead: true });\r\n\r\n    moveScale(realScale);\r\n  }, [realScale]);\r\n\r\n  // 运动开始\r\n  if (lead) {\r\n    return [realWidth * scale, realHeight * scale, realScale / scale] as const;\r\n  }\r\n\r\n  // 运动结束\r\n  return [realWidth * realScale, realHeight * realScale, 1] as const;\r\n}\r\n","import React, { useRef, useState } from 'react';\r\nimport type { DataType, PhotoProviderBase, OverlayRenderProps, ReachType } from './types';\r\nimport { defaultEasing, defaultSpeed, defaultOpacity, horizontalOffset, maxMoveOffset } from './variables';\r\nimport isTouchDevice from './utils/isTouchDevice';\r\nimport { limitNumber } from './utils/limitTarget';\r\nimport useIsomorphicLayoutEffect from './hooks/useIsomorphicLayoutEffect';\r\nimport useAdjacentImages from './hooks/useAdjacentImages';\r\nimport useSetState from './hooks/useSetState';\r\nimport useEventListener from './hooks/useEventListener';\r\nimport useAnimationVisible from './hooks/useAnimationVisible';\r\nimport useMethods from './hooks/useMethods';\r\nimport SlidePortal from './components/SlidePortal';\r\nimport CloseIcon from './components/CloseIcon';\r\nimport ArrowLeft from './components/ArrowLeft';\r\nimport ArrowRight from './components/ArrowRight';\r\nimport PreventScroll from './components/PreventScroll';\r\nimport PhotoBox from './PhotoBox';\r\nimport './PhotoSlider.less';\r\n\r\nexport interface IPhotoSliderProps extends PhotoProviderBase {\r\n  // 图片列表\r\n  images: DataType[];\r\n  // 图片当前索引\r\n  index?: number;\r\n  // 索引改变回调\r\n  onIndexChange?: (index: number) => void;\r\n  // 可见\r\n  visible: boolean;\r\n  // 关闭回调\r\n  onClose: (evt?: React.MouseEvent | React.TouchEvent) => void;\r\n  // 关闭动画结束后回调\r\n  afterClose?: () => void;\r\n\r\n  direction?: 'ltr' | 'rtl';\r\n}\r\n\r\ntype PhotoSliderState = {\r\n  // 偏移量\r\n  x: number;\r\n  // 图片处于触摸的状态\r\n  touched: boolean;\r\n  // 是否暂停 transition\r\n  pause: boolean;\r\n  // Reach 开始时 x 坐标\r\n  lastCX: number | undefined;\r\n  // Reach 开始时 y 坐标\r\n  lastCY: number | undefined;\r\n  // 背景透明度\r\n  bg: number | null | undefined;\r\n  // 上次关闭的背景透明度\r\n  lastBg: number | null | undefined;\r\n  // 是否显示 overlay\r\n  overlay: boolean;\r\n  // 是否为最小状态，可下拉关闭\r\n  minimal: boolean;\r\n  // 缩放\r\n  scale: number;\r\n  // 旋转\r\n  rotate: number;\r\n  // 缩放回调\r\n  onScale?: (scale: number) => void;\r\n  // 旋转回调\r\n  onRotate?: (rotate: number) => void;\r\n};\r\n\r\nconst initialState: PhotoSliderState = {\r\n  x: 0,\r\n  touched: false,\r\n  pause: false,\r\n  lastCX: undefined,\r\n  lastCY: undefined,\r\n  bg: undefined,\r\n  lastBg: undefined,\r\n  overlay: true,\r\n  minimal: true,\r\n  scale: 1,\r\n  rotate: 0,\r\n};\r\n\r\nexport default function PhotoSlider(props: IPhotoSliderProps) {\r\n  const {\r\n    loop = 3,\r\n    speed: speedFn,\r\n    easing: easingFn,\r\n    photoClosable,\r\n    maskClosable = true,\r\n    maskOpacity = defaultOpacity,\r\n    pullClosable = true,\r\n    bannerVisible = true,\r\n    overlayRender,\r\n    toolbarRender,\r\n    className,\r\n    maskClassName,\r\n    photoClassName,\r\n    photoWrapClassName,\r\n    loadingElement,\r\n    brokenElement,\r\n    images,\r\n    index: controlledIndex = 0,\r\n    onIndexChange: controlledIndexChange,\r\n    visible,\r\n    onClose,\r\n    afterClose,\r\n    portalContainer,\r\n  } = props;\r\n\r\n  const [state, updateState] = useSetState(initialState);\r\n  const [innerIndex, updateInnerIndex] = useState(0);\r\n\r\n  const {\r\n    x,\r\n    touched,\r\n    pause,\r\n\r\n    lastCX,\r\n    lastCY,\r\n\r\n    bg = maskOpacity,\r\n    lastBg,\r\n    overlay,\r\n    minimal,\r\n\r\n    scale,\r\n    rotate,\r\n    onScale,\r\n    onRotate,\r\n  } = state;\r\n\r\n  // 受控 index\r\n  const isControlled = props.hasOwnProperty('index');\r\n  const index = isControlled ? controlledIndex : innerIndex;\r\n  const onIndexChange = isControlled ? controlledIndexChange : updateInnerIndex;\r\n  // 内部虚拟 index\r\n  const virtualIndexRef = useRef(index);\r\n\r\n  // 当前图片\r\n  const imageLength = images.length;\r\n  const currentImage: DataType | undefined = images[index];\r\n\r\n  // 是否开启\r\n  // noinspection SuspiciousTypeOfGuard\r\n  const enableLoop = typeof loop === 'boolean' ? loop : imageLength > loop;\r\n\r\n  // 显示动画处理\r\n  const [realVisible, activeAnimation, onAnimationEnd] = useAnimationVisible(visible, afterClose);\r\n\r\n  useIsomorphicLayoutEffect(() => {\r\n    // 显示弹出层，修正正确的指向\r\n    if (realVisible) {\r\n      updateState({\r\n        pause: true,\r\n        x: index * -(innerWidth + horizontalOffset),\r\n      });\r\n      virtualIndexRef.current = index;\r\n      return;\r\n    }\r\n    // 关闭后清空状态\r\n    updateState(initialState);\r\n  }, [realVisible]);\r\n\r\n  const { close, changeIndex } = useMethods({\r\n    close(evt?: React.MouseEvent | React.TouchEvent) {\r\n      if (onRotate) {\r\n        onRotate(0);\r\n      }\r\n      updateState({\r\n        overlay: true,\r\n        // 记录当前关闭时的透明度\r\n        lastBg: bg,\r\n      });\r\n      onClose(evt);\r\n    },\r\n    changeIndex(nextIndex: number, isPause: boolean = false) {\r\n      // 当前索引\r\n      const currentIndex = enableLoop ? virtualIndexRef.current + (nextIndex - index) : nextIndex;\r\n      const max = imageLength - 1;\r\n      // 虚拟 index\r\n      // 非循环模式，限制区间\r\n      const limitIndex = limitNumber(currentIndex, 0, max);\r\n      const nextVirtualIndex = enableLoop ? currentIndex : limitIndex;\r\n      // 单个屏幕宽度\r\n      const singlePageWidth = innerWidth + horizontalOffset;\r\n\r\n      updateState({\r\n        touched: false,\r\n        lastCX: undefined,\r\n        lastCY: undefined,\r\n        x: -singlePageWidth * nextVirtualIndex,\r\n        pause: isPause,\r\n      });\r\n\r\n      virtualIndexRef.current = nextVirtualIndex;\r\n      // 更新真实的 index\r\n      const realLoopIndex = nextIndex < 0 ? max : nextIndex > max ? 0 : nextIndex;\r\n      if (onIndexChange) {\r\n        onIndexChange(enableLoop ? realLoopIndex : limitIndex);\r\n      }\r\n    },\r\n  });\r\n\r\n  useEventListener('keydown', (evt: KeyboardEvent) => {\r\n    if (visible) {\r\n      switch (evt.key) {\r\n        case 'ArrowLeft':\r\n          changeIndex(index - 1, true);\r\n          break;\r\n        case 'ArrowRight':\r\n          changeIndex(index + 1, true);\r\n          break;\r\n        case 'Escape':\r\n          close();\r\n          break;\r\n        default:\r\n      }\r\n    }\r\n  });\r\n\r\n  function handlePhotoTap(closeable: boolean | undefined) {\r\n    return closeable ? close() : updateState({ overlay: !overlay });\r\n  }\r\n\r\n  function handleResize() {\r\n    updateState({\r\n      x: -(innerWidth + horizontalOffset) * index,\r\n      lastCX: undefined,\r\n      lastCY: undefined,\r\n      pause: true,\r\n    });\r\n    virtualIndexRef.current = index;\r\n  }\r\n\r\n  function handleReachVerticalMove(clientY: number, nextScale?: number) {\r\n    if (lastCY === undefined) {\r\n      updateState({\r\n        touched: true,\r\n        lastCY: clientY,\r\n        bg,\r\n        minimal: true,\r\n      });\r\n      return;\r\n    }\r\n    const opacity =\r\n      maskOpacity === null ? null : limitNumber(maskOpacity, 0.01, maskOpacity - Math.abs(clientY - lastCY) / 100 / 4);\r\n\r\n    updateState({\r\n      touched: true,\r\n      lastCY,\r\n      bg: nextScale === 1 ? opacity : maskOpacity,\r\n      minimal: nextScale === 1,\r\n    });\r\n  }\r\n\r\n  function handleReachHorizontalMove(clientX: number) {\r\n    if (lastCX === undefined) {\r\n      updateState({\r\n        touched: true,\r\n        lastCX: clientX,\r\n        x,\r\n        pause: false,\r\n      });\r\n      return;\r\n    }\r\n    const originOffsetClientX = clientX - lastCX;\r\n    let offsetClientX = originOffsetClientX;\r\n\r\n    // 第一张和最后一张超出距离减半\r\n    if (\r\n      !enableLoop &&\r\n      ((index === 0 && originOffsetClientX > 0) || (index === imageLength - 1 && originOffsetClientX < 0))\r\n    ) {\r\n      offsetClientX = originOffsetClientX / 2;\r\n    }\r\n\r\n    updateState({\r\n      touched: true,\r\n      lastCX,\r\n      x: -(innerWidth + horizontalOffset) * virtualIndexRef.current + offsetClientX,\r\n      pause: false,\r\n    });\r\n  }\r\n\r\n  function handleReachMove(reachPosition: ReachType, clientX: number, clientY: number, nextScale?: number) {\r\n    if (reachPosition === 'x') {\r\n      handleReachHorizontalMove(clientX);\r\n    } else if (reachPosition === 'y') {\r\n      handleReachVerticalMove(clientY, nextScale);\r\n    }\r\n  }\r\n\r\n  function handleReachUp(clientX: number, clientY: number) {\r\n    const offsetClientX = clientX - (lastCX ?? clientX);\r\n    const offsetClientY = clientY - (lastCY ?? clientY);\r\n    let willClose = false;\r\n    // 下一张\r\n    if (offsetClientX < -maxMoveOffset) {\r\n      changeIndex(index + 1);\r\n      return;\r\n    }\r\n    // 上一张\r\n    if (offsetClientX > maxMoveOffset) {\r\n      changeIndex(index - 1);\r\n      return;\r\n    }\r\n    const singlePageWidth = innerWidth + horizontalOffset;\r\n    // 当前偏移\r\n    const currentTranslateX = -singlePageWidth * virtualIndexRef.current;\r\n\r\n    if (Math.abs(offsetClientY) > 100 && minimal && pullClosable) {\r\n      willClose = true;\r\n      close();\r\n    }\r\n    updateState({\r\n      touched: false,\r\n      x: currentTranslateX,\r\n      lastCX: undefined,\r\n      lastCY: undefined,\r\n      bg: maskOpacity,\r\n      overlay: willClose ? true : overlay,\r\n    });\r\n  }\r\n  // 截取相邻的图片\r\n  const adjacentImages = useAdjacentImages(images, index, enableLoop);\r\n\r\n  if (!realVisible) {\r\n    return null;\r\n  }\r\n\r\n  const currentOverlayVisible = overlay && !activeAnimation;\r\n  // 关闭过程中使用下拉保存的透明度\r\n  const currentOpacity = visible ? bg : lastBg;\r\n  // 覆盖物参数\r\n  const overlayParams: OverlayRenderProps | undefined = onScale &&\r\n    onRotate && {\r\n      images,\r\n      index,\r\n      visible,\r\n      onClose: close,\r\n      onIndexChange: changeIndex,\r\n      overlayVisible: currentOverlayVisible,\r\n      overlay: currentImage && currentImage.overlay,\r\n      scale,\r\n      rotate,\r\n      onScale,\r\n      onRotate,\r\n    };\r\n  // 动画时间\r\n  const currentSpeed = speedFn ? speedFn(activeAnimation) : defaultSpeed;\r\n  const currentEasing = easingFn ? easingFn(activeAnimation) : defaultEasing;\r\n  const slideSpeed = speedFn ? speedFn(3) : defaultSpeed + 200;\r\n  const slideEasing = easingFn ? easingFn(3) : defaultEasing;\r\n\r\n  return (\r\n    <SlidePortal\r\n      className={`PhotoView-Portal${!currentOverlayVisible ? ' PhotoView-Slider__clean' : ''}${\r\n        !visible ? ' PhotoView-Slider__willClose' : ''\r\n      }${className ? ` ${className}` : ''}`}\r\n      role=\"dialog\"\r\n      onClick={(e) => e.stopPropagation()}\r\n      container={portalContainer}\r\n    >\r\n      {visible && <PreventScroll />}\r\n      <div\r\n        className={`PhotoView-Slider__Backdrop${maskClassName ? ` ${maskClassName}` : ''}${\r\n          activeAnimation === 1\r\n            ? ' PhotoView-Slider__fadeIn'\r\n            : activeAnimation === 2\r\n              ? ' PhotoView-Slider__fadeOut'\r\n              : ''\r\n        }`}\r\n        style={{\r\n          background: currentOpacity ? `rgba(0, 0, 0, ${currentOpacity})` : undefined,\r\n          transitionTimingFunction: currentEasing,\r\n          transitionDuration: `${touched ? 0 : currentSpeed}ms`,\r\n          animationDuration: `${currentSpeed}ms`,\r\n        }}\r\n        onAnimationEnd={onAnimationEnd}\r\n      />\r\n      {bannerVisible && (\r\n        <div className=\"PhotoView-Slider__BannerWrap\">\r\n          <div className=\"PhotoView-Slider__Counter\">\r\n            {index + 1} / {imageLength}\r\n          </div>\r\n          <div className=\"PhotoView-Slider__BannerRight\">\r\n            {toolbarRender && overlayParams && toolbarRender(overlayParams)}\r\n            <CloseIcon className=\"PhotoView-Slider__toolbarIcon\" onClick={close} />\r\n          </div>\r\n        </div>\r\n      )}\r\n      {adjacentImages.map((item: DataType, currentIndex) => {\r\n        // 截取之前的索引位置\r\n        const nextIndex =\r\n          !enableLoop && index === 0 ? index + currentIndex : virtualIndexRef.current - 1 + currentIndex;\r\n\r\n        return (\r\n          <PhotoBox\r\n            key={enableLoop ? `${item.key}/${item.src}/${nextIndex}` : item.key}\r\n            item={item}\r\n            speed={currentSpeed}\r\n            easing={currentEasing}\r\n            visible={visible}\r\n            onReachMove={handleReachMove}\r\n            onReachUp={handleReachUp}\r\n            onPhotoTap={() => handlePhotoTap(photoClosable)}\r\n            onMaskTap={() => handlePhotoTap(maskClosable)}\r\n            wrapClassName={photoWrapClassName}\r\n            className={photoClassName}\r\n            style={{\r\n              left: `${(innerWidth + horizontalOffset) * nextIndex}px`,\r\n              transform: `translate3d(${x}px, 0px, 0)`,\r\n              transition: touched || pause ? undefined : `transform ${slideSpeed}ms ${slideEasing}`,\r\n            }}\r\n            loadingElement={loadingElement}\r\n            brokenElement={brokenElement}\r\n            onPhotoResize={handleResize}\r\n            isActive={virtualIndexRef.current === nextIndex}\r\n            expose={updateState}\r\n          />\r\n        );\r\n      })}\r\n      {!isTouchDevice && bannerVisible && (\r\n        <>\r\n          {(enableLoop || index !== 0) && (\r\n            <div className=\"PhotoView-Slider__ArrowLeft\" onClick={() => changeIndex(index - 1, true)}>\r\n              <ArrowLeft />\r\n            </div>\r\n          )}\r\n          {(enableLoop || index + 1 < imageLength) && (\r\n            <div className=\"PhotoView-Slider__ArrowRight\" onClick={() => changeIndex(index + 1, true)}>\r\n              <ArrowRight />\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n      {overlayRender && overlayParams && (\r\n        <div className=\"PhotoView-Slider__Overlay\">{overlayRender(overlayParams)}</div>\r\n      )}\r\n    </SlidePortal>\r\n  );\r\n}\r\n","import { useReducer, useRef } from 'react';\r\nimport type { ActiveAnimationType } from '../types';\r\nimport useForkedVariable from './useForkedVariable';\r\n\r\n/**\r\n * 动画关闭处理真实关闭状态\r\n * 通过 onAnimationEnd 回调实现 leaveCallback\r\n */\r\nexport default function useAnimationVisible(\r\n  visible: boolean | undefined,\r\n  afterClose?: () => void,\r\n): [realVisible: boolean | undefined, activeAnimation: ActiveAnimationType, onAnimationEnd: () => void] {\r\n  const [, handleRender] = useReducer((c) => !c, false);\r\n\r\n  const activeAnimation = useRef<ActiveAnimationType>(0);\r\n\r\n  // 可见状态分支\r\n  const [realVisible, modifyRealVisible] = useForkedVariable(visible, (modify) => {\r\n    // 可见状态：设置进入动画\r\n    if (visible) {\r\n      modify(visible);\r\n      activeAnimation.current = 1;\r\n    } else {\r\n      activeAnimation.current = 2;\r\n    }\r\n  });\r\n\r\n  function onAnimationEnd() {\r\n    // 动画结束后触发渲染\r\n    handleRender();\r\n    // 结束动画：设置隐藏状态\r\n    if (activeAnimation.current === 2) {\r\n      modifyRealVisible(false);\r\n      // 触发隐藏回调\r\n      if (afterClose) {\r\n        afterClose();\r\n      }\r\n    }\r\n    // 重置状态\r\n    activeAnimation.current = 0;\r\n  }\r\n\r\n  return [\r\n    /**\r\n     * 真实可见状态\r\n     */\r\n    realVisible,\r\n    /**\r\n     * 正在进行的动画\r\n     */\r\n    activeAnimation.current,\r\n    /**\r\n     * 动画结束后回调\r\n     */\r\n    onAnimationEnd,\r\n  ];\r\n}\r\n","import { useRef, useMemo } from 'react';\r\n\r\n/**\r\n * 逻辑分叉变量处理\r\n * 此 hook 不触发额外渲染\r\n */\r\nexport default function useForkedVariable<T>(initial: T, updater: (modify: (variable: T) => void) => void) {\r\n  // 初始分叉变量\r\n  const forkedRef = useRef(initial);\r\n\r\n  function modify(next: T) {\r\n    forkedRef.current = next;\r\n  }\r\n\r\n  useMemo(() => {\r\n    // 参数变化之后同步内部分叉变量\r\n    updater(modify);\r\n  }, [initial]);\r\n\r\n  return [forkedRef.current, modify] as const;\r\n}\r\n","import { useMemo } from 'react';\r\nimport type { DataType } from '../types';\r\n\r\n/**\r\n * 截取相邻三张图片\r\n */\r\nexport default function useAdjacentImages(images: DataType[], index: number, loop: boolean) {\r\n  return useMemo(() => {\r\n    const imageLength = images.length;\r\n    if (loop) {\r\n      const connected = images.concat(images).concat(images);\r\n      return connected.slice(imageLength + index - 1, imageLength + index + 2);\r\n    }\r\n    return images.slice(Math.max(index - 1, 0), Math.min(index + 2, imageLength + 1));\r\n  }, [images, index, loop]);\r\n}\r\n","import React, { useMemo, useRef } from 'react';\r\nimport type { DataType, PhotoProviderBase } from './types';\r\nimport useMethods from './hooks/useMethods';\r\nimport useSetState from './hooks/useSetState';\r\nimport PhotoContext from './photo-context';\r\nimport PhotoSlider from './PhotoSlider';\r\n\r\nexport interface PhotoProviderProps extends PhotoProviderBase {\r\n  children: React.ReactNode;\r\n  onIndexChange?: (index: number, state: PhotoProviderState) => void;\r\n  onVisibleChange?: (visible: boolean, index: number, state: PhotoProviderState) => void;\r\n}\r\n\r\ntype PhotoProviderState = {\r\n  images: DataType[];\r\n  visible: boolean;\r\n  index: number;\r\n};\r\n\r\nconst initialState: PhotoProviderState = {\r\n  images: [],\r\n  visible: false,\r\n  index: 0,\r\n};\r\n\r\nexport default function PhotoProvider({ children, onIndexChange, onVisibleChange, ...restProps }: PhotoProviderProps) {\r\n  const [state, updateState] = useSetState(initialState);\r\n  const uniqueIdRef = useRef(0);\r\n  const { images, visible, index } = state;\r\n\r\n  const methods = useMethods({\r\n    nextId() {\r\n      return (uniqueIdRef.current += 1);\r\n    },\r\n    update(imageItem: DataType) {\r\n      const currentIndex = images.findIndex((n) => n.key === imageItem.key);\r\n      if (currentIndex > -1) {\r\n        const nextImages = images.slice();\r\n        nextImages.splice(currentIndex, 1, imageItem);\r\n        updateState({\r\n          images: nextImages,\r\n        });\r\n        return;\r\n      }\r\n      updateState((prev) => ({\r\n        images: prev.images.concat(imageItem),\r\n      }));\r\n    },\r\n    remove(key: number) {\r\n      updateState((prev) => {\r\n        const nextImages = prev.images.filter((item) => item.key !== key);\r\n        const nextEndIndex = nextImages.length - 1;\r\n        return {\r\n          images: nextImages,\r\n          index: Math.min(nextEndIndex, index),\r\n        };\r\n      });\r\n    },\r\n    show(key: number) {\r\n      const currentIndex = images.findIndex((item) => item.key === key);\r\n      updateState({\r\n        visible: true,\r\n        index: currentIndex,\r\n      });\r\n      if (onVisibleChange) {\r\n        onVisibleChange(true, currentIndex, state);\r\n      }\r\n    },\r\n  });\r\n\r\n  const fn = useMethods({\r\n    close() {\r\n      updateState({\r\n        visible: false,\r\n      });\r\n\r\n      if (onVisibleChange) {\r\n        onVisibleChange(false, index, state);\r\n      }\r\n    },\r\n    changeIndex(nextIndex: number) {\r\n      updateState({\r\n        index: nextIndex,\r\n      });\r\n\r\n      if (onIndexChange) {\r\n        onIndexChange(nextIndex, state);\r\n      }\r\n    },\r\n  });\r\n\r\n  const value = useMemo(() => ({ ...state, ...methods }), [state, methods]);\r\n\r\n  return (\r\n    <PhotoContext.Provider value={value}>\r\n      {children}\r\n      <PhotoSlider\r\n        images={images}\r\n        visible={visible}\r\n        index={index}\r\n        onIndexChange={fn.changeIndex}\r\n        onClose={fn.close}\r\n        {...restProps}\r\n      />\r\n    </PhotoContext.Provider>\r\n  );\r\n}\r\n","import type React from 'react';\r\nimport { useImperativeHandle, Children, cloneElement, useContext, useEffect, useMemo, useRef } from 'react';\r\nimport useInitial from './hooks/useInitial';\r\nimport useMethods from './hooks/useMethods';\r\nimport type { PhotoContextType } from './photo-context';\r\nimport PhotoContext from './photo-context';\r\nimport type { PhotoRenderParams } from './types';\r\n\r\nexport interface PhotoViewProps {\r\n  /**\r\n   * 图片地址\r\n   */\r\n  src?: string;\r\n  /**\r\n   * 自定义渲染，优先级比 src 低\r\n   */\r\n  render?: (props: PhotoRenderParams) => React.ReactNode;\r\n  /**\r\n   * 自定义覆盖节点\r\n   */\r\n  overlay?: React.ReactNode;\r\n  /**\r\n   * 自定义渲染节点宽度\r\n   */\r\n  width?: number;\r\n  /**\r\n   * 自定义渲染节点高度\r\n   */\r\n  height?: number;\r\n  /**\r\n   * 子节点，一般为缩略图\r\n   */\r\n  children?: React.ReactElement;\r\n  /**\r\n   * 触发的事件\r\n   */\r\n  triggers?: ('onClick' | 'onDoubleClick')[];\r\n}\r\n\r\nconst PhotoView: React.FC<PhotoViewProps> = ({\r\n  src,\r\n  render,\r\n  overlay,\r\n  width,\r\n  height,\r\n  triggers = ['onClick'],\r\n  children,\r\n}) => {\r\n  const photoContext = useContext<PhotoContextType>(PhotoContext);\r\n  const key = useInitial(() => photoContext.nextId());\r\n  const originRef = useRef<HTMLElement>(null);\r\n\r\n  useImperativeHandle((children as React.FunctionComponentElement<HTMLElement>)?.ref, () => originRef.current);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      photoContext.remove(key);\r\n    };\r\n  }, []);\r\n\r\n  function invokeChildrenFn(eventName: string, e: React.SyntheticEvent) {\r\n    if (children) {\r\n      const eventFn = children.props[eventName];\r\n      if (eventFn) {\r\n        eventFn(e);\r\n      }\r\n    }\r\n  }\r\n\r\n  const fn = useMethods({\r\n    render(props: PhotoRenderParams) {\r\n      return render && render(props);\r\n    },\r\n    show(eventName: string, e: React.MouseEvent) {\r\n      photoContext.show(key);\r\n      invokeChildrenFn(eventName, e);\r\n    },\r\n  });\r\n\r\n  const eventListeners = useMemo(() => {\r\n    const listener = {};\r\n    triggers.forEach((eventName) => {\r\n      listener[eventName] = fn.show.bind(null, eventName);\r\n    });\r\n    return listener;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    photoContext.update({\r\n      key,\r\n      src,\r\n      originRef,\r\n      render: fn.render,\r\n      overlay,\r\n      width,\r\n      height,\r\n    });\r\n  }, [src]);\r\n\r\n  if (children) {\r\n    return Children.only(cloneElement(children, { ...eventListeners, ref: originRef }));\r\n  }\r\n  return null;\r\n};\r\n\r\nexport default PhotoView;\r\n","import { useRef } from 'react';\r\n\r\nexport default function useInitial<T extends (...args: any) => any>(callback: T) {\r\n  const { current } = useRef({ sign: false, fn: undefined as ReturnType<T> });\r\n  if (!current.sign) {\r\n    current.sign = true;\r\n    current.fn = callback();\r\n  }\r\n  return current.fn;\r\n}\r\n"],"names":["useMethods","fn","current","useRef","curr","undefined","Object","create","keys","forEach","key","_current$fn$key","call","apply","concat","slice","arguments","useSetState","initialState","useReducer","state","action","_extends","createContext","defaultEasing","horizontalOffset","isTouchDevice","window","limitNumber","value","min","max","Math","limitScale","scale","buffer","test","navigator","userAgent","useEffect","useLayoutEffect","useEventListener","type","options","latest","wrapper","evt","addEventListener","removeEventListener","SlidePortal","_ref","_ref$container","container","document","body","rest","_objectWithoutPropertiesLoose","_excluded","createPortal","_jsx","CloseIcon","props","width","height","viewBox","children","jsx","d","ArrowLeft","ArrowRight","PreventScroll","style","lastOverflow","overflow","getMultipleTouchPosition","_evt$touches$","touches","clientX","clientY","length","_evt$touches$2","nextClientX","nextClientY","sqrt","pow","computePositionEdge","position","size","innerSize","closedEdge","currentWidth","outOffset","getPositionOnMoveOrScale","x","y","toScale","offsetX","offsetY","innerWidth","innerHeight","closedEdgeX","_computePositionEdge2","centerClientX","centerClientY","lastCX","lastCY","getRotateSize","rotate","isVertical","getSuitableImageSize","naturalWidth","naturalHeight","_getRotateSize","currentHeight","autoWidth","autoHeight","pause","useDebounceCallback","callback","_ref$leading","leading","maxWait","_ref$wait","wait","callbackRef","prev","trailingTimeout","clearTrailing","clearTimeout","useCallback","args","now","Date","last","offset","setTimeout","cancel","rebound","start","bound","easeOutMove","defaultSpeed","t","easeOutQuart","end","speed","easing","complete","distance","startTime","frameId","calcMove","time","raf","cancelAnimationFrame","requestAnimationFrame","initialRect","T","L","W","H","FIT","useMountedRef","mountedRef","Spinner","_ref$className","className","_jsxs","fill","opacity","Photo","src","loaded","broken","onPhotoLoad","loadingElement","brokenElement","restProps","_Fragment","onLoad","e","_e$target","target","onError","draggable","alt","touched","maskTouched","CX","CY","lastX","lastY","lastScale","touchTime","touchLength","stopRaf","reach","PhotoBox","_ref$item","item","render","_ref$item$width","customWidth","_ref$item$height","customHeight","originRef","visible","wrapClassName","onPhotoTap","onMaskTap","onReachMove","onReachUp","onPhotoResize","isActive","expose","_useSetState","updateState","initialTouchRef","mounted","_state$naturalWidth","_state$naturalHeight","_state$width","_state$height","_state$loaded","onScale","onRotate","handleMove","currentTouchLength","isStillX","abs","isStillY","currentReach","horizontalCloseEdge","initialTouchState","verticalCloseEdge","reachPosition","getReachType","updateRaf","singleTap","doubleTap","continuousClick","debounceTap","callbackX","callbackY","callbackS","slideToPosition","nextX","nextY","nextScale","X","spatial","Y","S","safeScale","touchedTime","_computePositionEdge","beginEdgeX","beginX","beginEdgeY","beginY","moveTime","_getPositionOnMoveOrS","targetX","targetY","speedX","speedY","speedT","edgeX","edgeY","initialSpeed","lastTime","v","s","dt","direction","sign","a","f","ds","caf","scrollMove","_computePositionEdge3","isEdgeX","currentX","_computePositionEdge4","isEdgeY","currentY","resultX","resultY","handlePhotoTap","currentClientX","currentClientY","handleUp","handleStart","handleMaskStart","preventDefault","passive","_ref2","touch","changedTouches","useIsomorphicLayoutEffect","_useAnimationPosition","updateEasing","_useTargetScale","realWidth","realHeight","realScale","execRef","lead","_useSetState$","moveScale","Promise","resolve","reject","useTargetScale","autoScale","_useAnimationOrigin","_useState","useState","originRect","updateOriginRect","_useState2","easingMode","updateEasingMode","initialTime","OK","handleToShape","currentShape","element","nodeType","_element$getBoundingC","getBoundingClientRect","top","left","tagName","getComputedStyle","objectFit","handleUpdateOrigin","useAnimationOrigin","centerWidth","centerHeight","miniMode","useAnimationPosition","isPause","currentScale","transitionCSS","attrs","onMouseDown","stopPropagation","button","onTouchStart","onWheel","deltaY","transform","transition","translateY","willChange","params","bg","lastBg","overlay","minimal","PhotoSlider","_props$loop","loop","speedFn","easingFn","photoClosable","_props$maskClosable","maskClosable","_props$maskOpacity","maskOpacity","defaultOpacity","_props$pullClosable","pullClosable","_props$bannerVisible","bannerVisible","overlayRender","toolbarRender","maskClassName","photoClassName","photoWrapClassName","images","_props$index","index","controlledIndex","controlledIndexChange","onIndexChange","onClose","afterClose","portalContainer","innerIndex","updateInnerIndex","_state$bg","isControlled","hasOwnProperty","virtualIndexRef","imageLength","currentImage","enableLoop","_useAnimationVisible","handleRender","c","activeAnimation","_useForkedVariable","initial","forkedRef","modify","next","useMemo","updater","useForkedVariable","modifyRealVisible","useAnimationVisible","realVisible","onAnimationEnd","_useMethods","close","changeIndex","nextIndex","currentIndex","limitIndex","nextVirtualIndex","singlePageWidth","closeable","handleResize","handleReachMove","originOffsetClientX","offsetClientX","handleReachHorizontalMove","handleReachVerticalMove","handleReachUp","offsetClientY","willClose","currentTranslateX","adjacentImages","useAdjacentImages","currentOverlayVisible","currentOpacity","overlayParams","overlayVisible","currentSpeed","currentEasing","slideSpeed","slideEasing","jsxs","role","onClick","background","transitionTimingFunction","transitionDuration","animationDuration","map","Fragment","onVisibleChange","uniqueIdRef","methods","nextId","update","imageItem","findIndex","n","nextImages","splice","remove","filter","show","PhotoContext","Provider","_ref$triggers","triggers","photoContext","useContext","useImperativeHandle","ref","eventName","eventFn","invokeChildrenFn","eventListeners","listener","bind","Children","only","cloneElement"],"mappings":"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"}